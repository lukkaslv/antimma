<!DOCTYPE html>
<html lang="ka">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>მანიპულაციების წინააღმდეგ ტრენაჟორი</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    body.dark {
      background-color: #1a202c;
      color: #f7fafc;
    }
    .dark .bg-white {
      background-color: #2d3748;
    }
    .dark .text-gray-800 {
      color: #e2e8f0;
    }
    .dot {
      display: inline-block;
      width: 12px;
      height: 12px;
      margin: 0 4px;
      border-radius: 50%;
      background-color: #cbd5e0;
    }
    .dot.active {
      background-color: #3182ce;
    }
    .badge {
      display: inline-block;
      padding: 8px 12px;
      margin: 4px;
      border-radius: 20px;
      background-color: #e2e8f0;
      font-weight: bold;
    }
    .badge.acquired {
      background-color: #48bb78;
      color: white;
    }
  </style>
</head>
<body class="bg-white text-gray-800">
  <div class="container mx-auto p-4 max-w-2xl">
    <div class="flex justify-between items-center mb-4">
      <h1 class="text-2xl font-bold">🎯 მანიპულაციების წინააღმდეგ ტრენაჟორი</h1>
      <button id="theme-toggle" class="bg-gray-200 px-4 py-2 rounded">🌗 თემა</button>
    </div>
    
    <div id="scene-container" class="bg-white p-4 rounded shadow">
      <h2 id="scene-title" class="text-xl font-semibold mb-2"></h2>
      <p id="scene-description" class="mb-4"></p>
      <div id="scene-options" class="mb-4"></div>
      <p id="feedback" class="font-semibold mb-4 hidden"></p>
      <div class="flex justify-between">
        <button id="prev-btn" class="bg-gray-300 px-4 py-2 rounded">⬅️ უკან</button>
        <button id="next-btn" class="bg-blue-500 text-white px-4 py-2 rounded">➡️ შემდეგი</button>
      </div>
    </div>

    <div class="my-4 text-center">
      <p>🔥 ქულები: <span id="score">0</span></p>
      <div class="my-2" id="progress-dots"></div>
    </div>

    <div id="final-section" class="hidden bg-green-100 p-4 mt-6 rounded shadow">
      <h2 class="text-xl font-bold mb-2">🏁 დასრულება</h2>
      <p class="mb-2">მოგილოცავთ! თქვენ დაასრულეთ ტრენაჟორი.</p>
      <p class="mb-2">შეაგროვეთ <strong id="final-score">0</strong> ქულა.</p>
      <div class="mt-4">
        <span class="badge" id="badge1">🎉 პირველი ნაბიჯი</span>
        <span class="badge" id="badge2">🛡️ დაცვა</span>
        <span class="badge" id="badge3">💡 გონიერება</span>
        <span class="badge" id="badge4">🏆 ჩემპიონი</span>
      </div>
    </div>
  </div>

  <script>
    const scenes = {
      1: {
        title: "სცენა 1",
        description: "უფროსი ამბობს: „თუ შენ მართლა ზრუნავდი ამ კომპანიაზე, არ გააკეთებდი ამას.“",
        options: [
          "სიყვარულის გამოხატვა",
          "ბრალდება",
          "ემოციური მანიპულაცია"
        ],
        correct: [2],
        feedback: "ეს არის ბრალდება და ემოციური მანიპულაცია, რადგან ცდილობს დანაშაულის გრძნობა გამოიყენოს კონტროლის მიზნით."
      },
      2: {
        title: "სცენა 2",
        description: "თქვენს მეგობარს სთხოვეთ დახმარება, და მან გითხრათ: „შენ არასდროს ხარ იქ, როცა მე მჭირდები.“",
        options: [
          "დამცირება",
          "შანტაჟი",
          "ემოციური მანიპულაცია"
        ],
        correct: [2],
        feedback: "ეს ემოციური მანიპულაციაა — წარსულის მომენტებით ცდილობს დანაშაულის გრძნობის გამოწვევას."
      },
      // ... (Сцены 3–9 добавьте по аналогии, если нужно)
      10: {
        title: "სცენა 10 — დასრულება",
        description: "თქვენ წარმატებით დაასრულეთ ყველა სცენა. აი შედეგი:",
        options: [],
        correct: [],
        feedback: ""
      }
    };

    let currentScene = parseInt(localStorage.getItem("scene")) || 1;
    let score = parseInt(localStorage.getItem("score")) || 0;
    let visitedScenes = new Set(JSON.parse(localStorage.getItem("visited")) || [1]);
    let sceneAnswered = JSON.parse(localStorage.getItem("sceneAnswered") || "{}");

    function saveState() {
      localStorage.setItem("scene", currentScene);
      localStorage.setItem("score", score);
      localStorage.setItem("visited", JSON.stringify([...visitedScenes]));
      localStorage.setItem("sceneAnswered", JSON.stringify(sceneAnswered));
    }

    function updateProgressDots() {
      const container = document.getElementById("progress-dots");
      container.innerHTML = "";
      for (let i = 1; i <= 10; i++) {
        const dot = document.createElement("span");
        dot.classList.add("dot");
        if (i === currentScene) dot.classList.add("active");
        container.appendChild(dot);
      }
    }

    function renderScene() {
      const scene = scenes[currentScene];
      document.getElementById("scene-title").textContent = scene.title;
      document.getElementById("scene-description").textContent = scene.description;

      const optionsDiv = document.getElementById("scene-options");
      optionsDiv.innerHTML = "";

      if (scene.options.length > 0) {
        scene.options.forEach((opt, idx) => {
          const btn = document.createElement("button");
          btn.textContent = opt;
          btn.className = "bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded m-1";
          btn.onclick = () => selectOption(idx);
          optionsDiv.appendChild(btn);
        });
      }

      document.getElementById("feedback").classList.add("hidden");
      updateProgressDots();
      document.getElementById("score").textContent = score;
      saveState();

      if (currentScene === 10) {
        document.getElementById("final-section").classList.remove("hidden");
        showFinalResults();
      } else {
        document.getElementById("final-section").classList.add("hidden");
      }

      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function selectOption(selectedIdx) {
      const scene = scenes[currentScene];
      if (sceneAnswered[currentScene]) return;

      sceneAnswered[currentScene] = true;

      const correct = scene.correct.includes(selectedIdx);
      const partial = scene.correct.length > 1 && scene.correct.includes(selectedIdx);

      if (correct) {
        score += 2;
      } else if (partial) {
        score += 1;
      }

      document.getElementById("feedback").textContent = scene.feedback;
      document.getElementById("feedback").classList.remove("hidden");

      saveState();
      document.getElementById("score").textContent = score;
    }

    function goToScene(num) {
      currentScene = num;
      visitedScenes.add(num);
      renderScene();
    }

    document.getElementById("next-btn").onclick = () => {
      if (currentScene < 10) goToScene(currentScene + 1);
    };
    document.getElementById("prev-btn").onclick = () => {
      if (currentScene > 1) goToScene(currentScene - 1);
    };

    document.getElementById("theme-toggle").onclick = () => {
      document.body.classList.toggle("dark");
    };

    function showFinalResults() {
      document.getElementById("final-score").textContent = score;
      if (score >= 2) document.getElementById("badge1").classList.add("acquired");
      if (score >= 10) document.getElementById("badge3").classList.add("acquired");
      if (score >= 18) document.getElementById("badge4").classList.add("acquired");

      const defenseCount = Object.keys(sceneAnswered).length;
      if (defenseCount >= 5) document.getElementById("badge2").classList.add("acquired");
    }

    window.onload = () => {
      renderScene();
    };
  </script>
</body>
</html>
